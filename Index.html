<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MockMsg">
  
  <!-- Theme Colors -->
  <meta name="theme-color" content="#25D366">
  
  <title>Mockup Messenger - Dreharbeit</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.3.1",
      "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
      "lucide-react": "https://esm.sh/lucide-react@0.487.0"
    }
  }
  </script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body, #root {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      overscroll-behavior: none;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    input, textarea {
      user-select: text;
      -webkit-user-select: text;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    .animate-bounce {
      animation: bounce 0.6s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { 
      MessageCircle, ArrowLeft, Phone, Video, MoreVertical, Search, 
      Smile, Paperclip, Mic, Check, CheckCheck, User, Wifi, 
      Battery, Signal, X, Settings, Camera, Send
    } from 'lucide-react';

    // Types
    const defaultData = {
      contacts: [
        { id: 'c1', name: 'Anna Meier', status: 'online' },
        { id: 'c2', name: 'Jonas Kramer', status: 'zuletzt heute um 14:22' }
      ],
      chats: {
        c1: [
          { id: 'm1', from: 'c1', text: 'Bin gleich da!', time: '14:21', status: 'read' },
          { id: 'm2', from: 'me', text: 'Ok, ich warte.', time: '14:22', status: 'read' }
        ],
        c2: [
          { id: 'm3', from: 'c2', text: 'Hallo! Wie gehts?', time: '09:15', status: 'read' }
        ]
      },
      fakeTriggers: [
        {
          id: 't1',
          chatId: 'c1',
          type: 'timer',
          delaySec: 8,
          showTyping: true,
          typingDuration: 2,
          message: { from: 'c1', text: 'Stehe vor der Tür.', time: '14:23', status: 'delivered' }
        }
      ],
      systemStatus: {
        time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }),
        battery: { percent: 78, charging: false },
        wifi: 3,
        network: { type: '5G', provider: 'MockTel' },
        darkMode: false
      }
    };

    // StatusBar Component
    function StatusBar({ status }) {
      return React.createElement('div', { 
        className: `flex items-center justify-between px-6 py-2 text-xs ${status.darkMode ? 'bg-[#1f2c33] text-gray-300' : 'bg-white text-gray-800'}`
      }, [
        React.createElement('span', { key: 'time', className: 'font-medium' }, status.time),
        React.createElement('div', { key: 'icons', className: 'flex items-center gap-1' }, [
          React.createElement(Signal, { key: 'signal', className: 'w-3 h-3' }),
          React.createElement(Wifi, { key: 'wifi', className: 'w-3 h-3' }),
          React.createElement(Battery, { key: 'battery', className: 'w-3 h-3' }),
          React.createElement('span', { key: 'percent' }, status.battery.percent + '%')
        ])
      ]);
    }

    // ChatList Component
    function ChatList({ contacts, chats, systemStatus, onOpenChat, onOpenDebug }) {
      return React.createElement('div', { 
        className: `min-h-screen ${systemStatus.darkMode ? 'bg-[#121212]' : 'bg-white'}`
      }, [
        React.createElement(StatusBar, { key: 'status', status: systemStatus }),
        
        React.createElement('div', { 
          key: 'header',
          className: `px-6 py-4 ${systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-[#008069]'}`
        }, [
          React.createElement('div', { key: 'content', className: 'flex items-center justify-between' }, [
            React.createElement('h1', { key: 'title', className: 'text-2xl font-semibold text-white' }, 'WhatsApp'),
            React.createElement('div', { key: 'actions', className: 'flex gap-6' }, [
              React.createElement(Search, { key: 'search', className: 'w-6 h-6 text-white cursor-pointer' }),
              React.createElement(MoreVertical, { 
                key: 'more', 
                className: 'w-6 h-6 text-white cursor-pointer',
                onClick: onOpenDebug
              })
            ])
          ])
        ]),

        React.createElement('div', { key: 'chats', className: 'divide-y divide-gray-200' },
          contacts.map(contact => {
            const messages = chats[contact.id] || [];
            const lastMsg = messages[messages.length - 1];
            
            return React.createElement('div', {
              key: contact.id,
              onClick: () => onOpenChat(contact.id),
              className: `flex items-center gap-4 px-6 py-4 cursor-pointer hover:bg-gray-50 ${systemStatus.darkMode ? 'bg-[#121212] hover:bg-[#1f2c33] border-gray-800' : ''}`
            }, [
              React.createElement('div', { 
                key: 'avatar',
                className: `w-12 h-12 rounded-full flex items-center justify-center ${systemStatus.darkMode ? 'bg-[#2a3942]' : 'bg-gray-300'}`
              }, React.createElement(User, { className: `w-6 h-6 ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-600'}` })),
              
              React.createElement('div', { key: 'info', className: 'flex-1 min-w-0' }, [
                React.createElement('div', { key: 'top', className: 'flex justify-between items-baseline' }, [
                  React.createElement('h3', { 
                    key: 'name',
                    className: `font-semibold ${systemStatus.darkMode ? 'text-white' : 'text-gray-900'}`
                  }, contact.name),
                  React.createElement('span', { 
                    key: 'time',
                    className: `text-xs ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-500'}`
                  }, lastMsg?.time || '')
                ]),
                React.createElement('p', { 
                  key: 'msg',
                  className: `text-sm truncate ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-600'}`
                }, lastMsg?.text || 'Noch keine Nachrichten')
              ])
            ]);
          })
        )
      ]);
    }

    // ChatView Component
    function ChatView({ contact, messages, systemStatus, fakeTriggers, activeTriggers, onBack, onSendMessage, onTriggerActivated, onFakeMessage }) {
      const [inputText, setInputText] = useState('');
      const [isTyping, setIsTyping] = useState(false);

      useEffect(() => {
        fakeTriggers.forEach(trigger => {
          if (trigger.type === 'timer' && !activeTriggers.has(trigger.id)) {
            setTimeout(() => {
              if (trigger.showTyping) {
                setIsTyping(true);
                setTimeout(() => {
                  setIsTyping(false);
                  onFakeMessage(trigger.message);
                  onTriggerActivated(trigger.id);
                }, (trigger.typingDuration || 2) * 1000);
              } else {
                onFakeMessage(trigger.message);
                onTriggerActivated(trigger.id);
              }
            }, (trigger.delaySec || 0) * 1000);
          }
        });
      }, [fakeTriggers, activeTriggers]);

      const handleSend = () => {
        if (inputText.trim()) {
          onSendMessage(inputText);
          setInputText('');
        }
      };

      const handleScreenTap = () => {
        fakeTriggers.forEach(trigger => {
          if (trigger.type === 'tap' && !activeTriggers.has(trigger.id)) {
            onFakeMessage(trigger.message);
            onTriggerActivated(trigger.id);
          }
        });
      };

      return React.createElement('div', { 
        className: `min-h-screen flex flex-col ${systemStatus.darkMode ? 'bg-[#0b141a]' : 'bg-[#efeae2]'}`,
        onClick: handleScreenTap
      }, [
        React.createElement(StatusBar, { key: 'status', status: systemStatus }),
        
        React.createElement('div', { 
          key: 'header',
          className: `px-4 py-3 flex items-center gap-4 ${systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-[#008069]'}`
        }, [
          React.createElement(ArrowLeft, { 
            key: 'back',
            className: 'w-6 h-6 text-white cursor-pointer',
            onClick: onBack
          }),
          React.createElement('div', { 
            key: 'avatar',
            className: `w-10 h-10 rounded-full flex items-center justify-center ${systemStatus.darkMode ? 'bg-[#2a3942]' : 'bg-white/20'}`
          }, React.createElement(User, { className: `w-5 h-5 ${systemStatus.darkMode ? 'text-gray-400' : 'text-white'}` })),
          React.createElement('div', { key: 'info', className: 'flex-1' }, [
            React.createElement('h2', { key: 'name', className: 'text-white font-semibold' }, contact.name),
            React.createElement('p', { key: 'status', className: 'text-white/80 text-xs' }, contact.status)
          ]),
          React.createElement(Video, { key: 'video', className: 'w-5 h-5 text-white cursor-pointer' }),
          React.createElement(Phone, { key: 'phone', className: 'w-5 h-5 text-white cursor-pointer' }),
          React.createElement(MoreVertical, { key: 'more', className: 'w-5 h-5 text-white cursor-pointer' })
        ]),

        React.createElement('div', { key: 'messages', className: 'flex-1 overflow-y-auto px-4 py-4 space-y-2' }, [
          ...messages.map(msg => 
            React.createElement('div', {
              key: msg.id,
              className: `flex ${msg.from === 'me' ? 'justify-end' : 'justify-start'}`
            }, React.createElement('div', {
              className: `max-w-[75%] rounded-lg px-4 py-2 ${
                msg.from === 'me' 
                  ? systemStatus.darkMode ? 'bg-[#005c4b]' : 'bg-[#d9fdd3]'
                  : systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-white'
              }`
            }, [
              React.createElement('p', { 
                key: 'text',
                className: `text-sm ${systemStatus.darkMode ? 'text-white' : 'text-gray-900'}`
              }, msg.text),
              React.createElement('div', { key: 'meta', className: 'flex items-center justify-end gap-1 mt-1' }, [
                React.createElement('span', { 
                  key: 'time',
                  className: `text-xs ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-500'}`
                }, msg.time),
                msg.from === 'me' && React.createElement(
                  msg.status === 'read' ? CheckCheck : msg.status === 'delivered' ? CheckCheck : Check,
                  { 
                    key: 'check',
                    className: `w-4 h-4 ${msg.status === 'read' ? 'text-blue-500' : 'text-gray-500'}`
                  }
                )
              ])
            ]))
          ),
          
          isTyping && React.createElement('div', { key: 'typing', className: 'flex justify-start' },
            React.createElement('div', { 
              className: `rounded-lg px-4 py-3 ${systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-white'}`
            }, React.createElement('div', { className: 'flex gap-1' }, [
              React.createElement('div', { 
                key: '1',
                className: `w-2 h-2 rounded-full animate-bounce ${systemStatus.darkMode ? 'bg-gray-400' : 'bg-gray-600'}`,
                style: { animationDelay: '0ms' }
              }),
              React.createElement('div', { 
                key: '2',
                className: `w-2 h-2 rounded-full animate-bounce ${systemStatus.darkMode ? 'bg-gray-400' : 'bg-gray-600'}`,
                style: { animationDelay: '150ms' }
              }),
              React.createElement('div', { 
                key: '3',
                className: `w-2 h-2 rounded-full animate-bounce ${systemStatus.darkMode ? 'bg-gray-400' : 'bg-gray-600'}`,
                style: { animationDelay: '300ms' }
              })
            ]))
          )
        ]),

        React.createElement('div', { 
          key: 'input',
          className: `px-2 py-2 flex items-center gap-2 ${systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-[#f0f0f0]'}`
        }, [
          React.createElement(Smile, { 
            key: 'emoji',
            className: `w-6 h-6 cursor-pointer ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-600'}`
          }),
          React.createElement('input', {
            key: 'text',
            type: 'text',
            value: inputText,
            onChange: (e) => setInputText(e.target.value),
            onKeyPress: (e) => e.key === 'Enter' && handleSend(),
            placeholder: 'Nachricht',
            className: `flex-1 px-4 py-2 rounded-full outline-none ${
              systemStatus.darkMode ? 'bg-[#2a3942] text-white placeholder-gray-400' : 'bg-white text-gray-900'
            }`
          }),
          React.createElement(Paperclip, { 
            key: 'attach',
            className: `w-6 h-6 cursor-pointer ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-600'}`
          }),
          inputText.trim() ? 
            React.createElement('div', {
              key: 'send',
              onClick: handleSend,
              className: 'w-10 h-10 bg-[#008069] rounded-full flex items-center justify-center cursor-pointer'
            }, React.createElement(Send, { className: 'w-5 h-5 text-white' })) :
            React.createElement(Mic, { 
              key: 'mic',
              className: `w-6 h-6 cursor-pointer ${systemStatus.darkMode ? 'text-gray-400' : 'text-gray-600'}`
            })
        ])
      ]);
    }

    // DebugPanel Component
    function DebugPanel({ appData, onClose, onUpdate, onResetSession }) {
      return React.createElement('div', { className: 'fixed inset-0 bg-black/50 z-50 flex items-end' },
        React.createElement('div', { 
          className: `w-full rounded-t-3xl max-h-[90vh] overflow-y-auto ${appData.systemStatus.darkMode ? 'bg-[#1f2c33]' : 'bg-white'}`
        }, [
          React.createElement('div', { 
            key: 'header',
            className: `sticky top-0 px-6 py-4 border-b flex justify-between items-center ${appData.systemStatus.darkMode ? 'bg-[#1f2c33] border-gray-700' : 'bg-white'}`
          }, [
            React.createElement('h2', { 
              key: 'title',
              className: `text-xl font-bold ${appData.systemStatus.darkMode ? 'text-white' : 'text-gray-900'}`
            }, 'Debug Panel'),
            React.createElement(X, { 
              key: 'close',
              className: `w-6 h-6 cursor-pointer ${appData.systemStatus.darkMode ? 'text-white' : ''}`,
              onClick: onClose
            })
          ]),
          
          React.createElement('div', { key: 'content', className: 'p-6 space-y-4' }, [
            React.createElement('button', {
              key: 'dark',
              onClick: () => onUpdate({ ...appData, systemStatus: { ...appData.systemStatus, darkMode: !appData.systemStatus.darkMode }}),
              className: 'w-full py-3 bg-blue-500 text-white rounded-lg font-semibold'
            }, 'Dark Mode umschalten'),
            
            React.createElement('button', {
              key: 'reset',
              onClick: onResetSession,
              className: 'w-full py-3 bg-red-500 text-white rounded-lg font-semibold'
            }, 'Session zurücksetzen'),

            React.createElement('div', { 
              key: 'info',
              className: `p-4 rounded-lg ${appData.systemStatus.darkMode ? 'bg-[#2a3942]' : 'bg-gray-100'}`
            }, [
              React.createElement('h3', { 
                key: 'title',
                className: `font-semibold mb-2 ${appData.systemStatus.darkMode ? 'text-white' : ''}`
              }, 'System Status'),
              React.createElement('p', { 
                key: 'text',
                className: `text-sm ${appData.systemStatus.darkMode ? 'text-gray-300' : 'text-gray-700'}`
              }, [
                'Zeit: ' + appData.systemStatus.time,
                React.createElement('br', { key: 'br1' }),
                'Akku: ' + appData.systemStatus.battery.percent + '%',
                React.createElement('br', { key: 'br2' }),
                'Netzwerk: ' + appData.systemStatus.network.type
              ])
            ])
          ])
        ])
      );
    }

    // FilmMode Component
    function FilmMode({ darkMode }) {
      const [filmMode, setFilmMode] = useState(false);

      return React.createElement('div', { className: 'fixed bottom-4 right-4 z-40' }, [
        filmMode && React.createElement('div', {
          key: 'indicator',
          className: 'absolute -top-12 right-0 bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold animate-pulse'
        }, 'FILM-MODUS AKTIV'),
        
        React.createElement('button', {
          key: 'button',
          onClick: () => setFilmMode(!filmMode),
          className: `w-14 h-14 rounded-full flex items-center justify-center shadow-lg ${
            filmMode ? 'bg-red-600 animate-pulse' : darkMode ? 'bg-green-600' : 'bg-green-500'
          }`
        }, React.createElement(Camera, { className: 'w-6 h-6 text-white' }))
      ]);
    }

    // Main App Component
    function App() {
      const [appData, setAppData] = useState(defaultData);
      const [currentView, setCurrentView] = useState('list');
      const [activeChat, setActiveChat] = useState(null);
      const [sessionMessages, setSessionMessages] = useState({});
      const [debugOpen, setDebugOpen] = useState(false);
      const [activeTriggers, setActiveTriggers] = useState(new Set());

      // Update time every minute
      useEffect(() => {
        const timer = setInterval(() => {
          setAppData(prev => ({
            ...prev,
            systemStatus: {
              ...prev.systemStatus,
              time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })
            }
          }));
        }, 60000);
        return () => clearInterval(timer);
      }, []);

      const openChat = (contactId) => {
        setActiveChat(contactId);
        setCurrentView('chat');
      };

      const getChatMessages = (chatId) => {
        const persistent = appData.chats[chatId] || [];
        const session = sessionMessages[chatId] || [];
        return [...persistent, ...session];
      };

      const addSessionMessage = (chatId, message) => {
        setSessionMessages(prev => ({
          ...prev,
          [chatId]: [...(prev[chatId] || []), message]
        }));
      };

      const resetSession = () => {
        setSessionMessages({});
        setActiveTriggers(new Set());
        setDebugOpen(false);
      };

      // 3-finger tap detection
      useEffect(() => {
        const handler = (e) => {
          if (e.touches.length === 3) {
            setDebugOpen(prev => !prev);
          }
        };
        window.addEventListener('touchstart', handler);
        return () => window.removeEventListener('touchstart', handler);
      }, []);

      return React.createElement('div', { className: 'max-w-md mx-auto relative' }, [
        currentView === 'list' && React.createElement(ChatList, {
          key: 'list',
          contacts: appData.contacts,
          chats: appData.chats,
          systemStatus: appData.systemStatus,
          onOpenChat: openChat,
          onOpenDebug: () => setDebugOpen(true)
        }),

        currentView === 'chat' && activeChat && React.createElement(ChatView, {
          key: 'chat',
          contact: appData.contacts.find(c => c.id === activeChat),
          messages: getChatMessages(activeChat),
          systemStatus: appData.systemStatus,
          fakeTriggers: appData.fakeTriggers.filter(t => t.chatId === activeChat),
          activeTriggers: activeTriggers,
          onBack: () => setCurrentView('list'),
          onSendMessage: (text) => {
            const newMessage = {
              id: `m${Date.now()}`,
              from: 'me',
              text,
              time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }),
              status: 'sent'
            };
            addSessionMessage(activeChat, newMessage);
          },
          onTriggerActivated: (triggerId) => {
            setActiveTriggers(prev => new Set([...prev, triggerId]));
          },
          onFakeMessage: (msg) => {
            addSessionMessage(activeChat, { ...msg, id: `m${Date.now()}` });
          }
        }),

        debugOpen && React.createElement(DebugPanel, {
          key: 'debug',
          appData: appData,
          onClose: () => setDebugOpen(false),
          onUpdate: setAppData,
          onResetSession: resetSession
        }),

        React.createElement(FilmMode, { 
          key: 'film',
          darkMode: appData.systemStatus.darkMode 
        })
      ]);
    }

    // Render the app
    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
